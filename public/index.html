<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fahrschule – Anmeldung</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    label { display:block; margin-top: 14px; font-weight: 600; }
    input, select, textarea { width: 100%; padding: 10px; margin-top: 6px; }
    button { margin-top: 18px; padding: 12px 16px; cursor:pointer; }
    .hidden { display:none; }
    .notice { margin-top: 14px; }
  </style>
</head>

<body>
  <h1>Anmeldung in 1 Minute</h1>

  <form id="leadForm">
    <label>Vorname</label>
    <input name="firstName" required />

    <label>Nachname</label>
    <input name="lastName" required />

    <label>E-Mail</label>
    <input name="email" type="email" required />

    <label>Telefon (z.B. +4179...)</label>
    <input name="phone" required />

    <label>Wohnort</label>
    <input name="city" required />

    <label>Kategorie</label>
    <select name="category" required>
      <option value="">Bitte wählen…</option>
      <option>B</option>
      <option>A</option>
      <option>BE</option>
      <option>Andere</option>
    </select>

    <label>Wie hast du uns gefunden?</label>
    <select name="source" required>
      <option value="">Bitte wählen…</option>
      <option>Google</option>
      <option>Instagram</option>
      <option>TikTok</option>
      <option>Empfehlung</option>
      <option>Andere</option>
    </select>

    <label>Nachricht (optional)</label>
    <textarea name="message" rows="4"></textarea>

    <!-- Honeypot (Spam-Falle): echte Nutzer füllen das nicht aus -->
    <div class="hidden">
      <label>Website</label>
      <input name="website" autocomplete="off" />
    </div>

    <button type="submit">Jetzt anmelden</button>
    <p class="notice" id="status"></p>
  </form>

  <script>
    const form = document.getElementById('leadForm');
    const statusEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = "Sende…";

      const fd = new FormData(form);
      const payload = Object.fromEntries(fd.entries());

      try {
        const res = await fetch('/api/lead', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const data = await res.json();

        if (!res.ok) throw new Error(data?.error || 'Fehler beim Senden');

        statusEl.textContent = "✅ Danke! Wir melden uns innerhalb von 24 Stunden.";
        form.reset();
      } catch (err) {
        statusEl.textContent = "❌ Konnte nicht gesendet werden: " + err.message;
      }
    });
  </script>
</body>
</html>
